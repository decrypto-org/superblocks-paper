\section{Interlinks as sets of superblocks}\label{sec.construction}

In superblock-enabled blockchains, the interlink vector stored in each block $B$
contains one pointer per superblock level $\mu$, namely a pointer to the most
recent superblock preceding $B$ of the respective level $\mu$. This
construction, known as an \emph{interlink list}, is realized by inductively
updating the interlink of the previous block, as shown in
Algorithm~\ref{alg.interlink}. The algorithm works as follows. Trivially,
genesis has an empty interlink vector, which forms our inductive basis. Given a
newly mined block $B'$ which already has an interlink vector (the inductive
hypothesis), we wish to construct the interlink vector to be included in the
next block, which will point to $B'$ itself as well as some of the blocks that
$B'$ points to. This is done by inspecting the existing interlink,
$B'.\textsf{interlink}$, and constructing a new interlink $\textsf{interlink}$
by replacing all the entries in $B'.\textsf{interlink}$ that are of level lower
than $B'$ with $B'$ itself.

\import{./}{algorithms/alg.interlink.tex}

Here, we make the novel but simple observation that the interlink structure
constructed in this manner often contains \emph{duplicate pointers}. In fact, as
we will show, most of the interlink pointers are duplicate. Space can be saved
by constructing an \emph{interlink set} instead. This construction is shown in
Algorithm~\ref{alg.interlink-set}. The algorithm returns the exact same data
structure as Algorithm~\ref{alg.interlink}, but with duplicates removed. The
algorithm operates as follows. Given an existing interlink set,
$B'.\textsf{interlinkSet}$, it produces a new set $\textsf{interlinkSet}$ which
contains $B'$ and all the same blocks as $B'.\textsf{interlinkSet}$ with the
exception of those that are of inferior superblock level than $B'$.

Naturally, when this interlink set is to be committed to a Merkle tree, it must
be ordered in a canonical matter (for example, by increasing block level) so
that its root can be deterministically reproduced and detected. This canonical
ordering may now not be trivial as was in the case for interlink lists and must
be specified by the implementation.

\import{./}{algorithms/alg.interlink-set-update.tex}

Let $B^n_\mu \in \{0, 1\}$ denote the random variable containing the value of
the $\mu^{\text{th}}$ digit after $n$ turns. Then we have that:

\begin{align*}
\Pr[B^n_\mu = 1] =
\sum_{i = 1}^n 2^{-\mu} \prod_{j = i + 1}^n \sum_{\mu' = 1}^{\mu - 1} 2^{-\mu'} &=\\
\sum_{i = 1}^n 2^{-\mu} \prod_{j = i + 1}^n (1 - 2^{1 - \mu}) &=\\
\sum_{i = 1}^n 2^{-\mu} (1 - 2^{1 -\mu})^{n - (i + 1) + 1} &=\\
\sum_{i = 1}^n 2^{-\mu} (1 - 2^{1 -\mu})^{n - i} &=\\
2^{-\mu} \sum_{i = 1}^n (1 - 2^{1 -\mu})^{n - i} &=\\
2^{-\mu} (1 - 2^{1 - \mu})^n \sum_{i = 1}^n (1 - 2^{1 -\mu})^{-i} &=\\
2^{-\mu} \frac{(1 - 2^{1 - \mu})^n (1 - (1 - 2^{1-\mu})^{-n})}{(1 - 2^{1 - \mu})(1 - (1 - 2^{1 - \mu})^{-1})} &=\\
\end{align*}

\TODO{TODO: Simplify above formula?}

We can now calculate the expected value for the number of $1$s in the
number:

\begin{align*}
  \EX[\sum_{\mu = 1}^\infty B^n_\mu] =^? \frac{\log_2(n)}{2}??
\end{align*}

\TODO{TODO: Calculate above expectation}
